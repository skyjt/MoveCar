# Move Car 挪车码（开源自部署）需求文档·简版

定位：开源、可自部署、隐私友好的“公共挪车码”工具。目标是第一版能本地/个人服务器快速部署，解决“匿名联系车主”的核心问题，后续逐步迭代即可。

## 一、基础功能（MVP）

- 挪车码管理：创建/查看/启用/停用/删除多个挪车码；可填写备注/昵称。
  - 不同的挪车码，能够手动在后台启动或关闭，关闭后，扫码会提示未生效
  - 后台需要密码登录，密码在配置文件中进行配置写死
  - 后台需要保留扫码通知记录，用户可以查询扫码记录、发送文本内容、聊天记录等，每次扫码生成一个唯一码，记录此次扫描下的所有通信记录
- 电子码与打印：
  - 网页展示二维码（电子码）；
  - 在线生成可打印 PDF（至少 1 套模板，含简单说明）。
- 扫码页面（免登录）：
  - 访客可发送匿名文本消息（简易聊天室）或留言（文本 + 1 张图片，≤5MB）；
  - 可以留下自己的联系方式，方便收到通知的用户可以联系
  - 显示“无需手机号，保护隐私”。
  - 自动获取当前位置并发送给车主，车主可以根据地址判断请求是否合理。
- 车主端：
  - 通过 webhook 通知用户（例如 bark 等工具），通知内容包含网页链接，点开可进入建议的一次性聊天室和扫码用户进行简单交流回复；
  - 消息/留言列表（按时间倒序）；
  - 回复消息、标记“已处理/稍后处理/拒绝”。
- 基础防滥用：
  - 频控（同 IP/同码 N 秒内限 1 次，可配置）；
  - 码级黑名单；
  - 可选简易验证码（开启/关闭）。
  - 当请求过于频繁，弹验证码
- 自部署：
  - Docker Compose 一键启动；默认 SQLite；
  - 提供 `.env.example` 与简要部署说明。

验收（MVP）：

- 能生成二维码并打印导出；
- 扫码可发消息/留言并在车主端看到；
- 车主可回复并标记处理；
- 频控/黑名单生效；
- Docker Compose 启动后可直接完成上述流程。

## 二、使用流程（简）

- 车主：登录 → 新建挪车码 → 打印或展示电子码 → 接收消息/留言 → 回复/标记处理。
- 扫码者：扫码 → 输入诉求（可附 1 张图片）→ 发送 → 等待响应或离开留言。

## 三、非功能（最小）

- 运行：单实例即可；重启可恢复。
- 数据：默认保留 7 天（消息/图片/日志）。
- 安全：建议 HTTPS（不强制，由用户自行反代配置）；基础输入校验与上传大小/类型限制。

## 四、部署要求

- 依赖：Docker、Docker Compose。
- 默认：SQLite 存储；
- 可选：反向代理（Caddy/Nginx）启用 HTTPS；
- 配置：`.env.example` 提供端口、站点名、初始化管理员等基础项。

## 五、后续迭代（按优先级）

- P1：
  - 通知适配器：Email（SMTP）/Telegram/NTFY（先实现其一）；
  - 多成员共享同一码（家庭共享）；
  - 电子码有效期/一次性码；
  - 国际化（简/繁/英）；
  - PWA 与浏览器通知（可选）。
- P2：
  - WebRTC 语音（点对点，附 TURN 示例配置）；
  - 审计导出（CSV/JSON）；
  - 主题与品牌自定义（Logo/颜色/文案）；
  - 批量导入与 NFC 标签写入；
  - 多租户（社区实例）。
